<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>지금 뭐먹지?</title>

  <!-- bootstrap CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  
  <!-- Font Awesome CDN-->
  <script src="https://kit.fontawesome.com/14db1d786f.js" crossorigin="anonymous"></script>

  <link rel="stylesheet" href="./css/mainStyle.css">
  <link rel="stylesheet" href="./css/main_toy.css">
  <link rel="stylesheet" href="./css/main_toy_animation.css">
  <link rel="stylesheet" href="./css/mainResponsiveQuery.css"> 

  <style>
    main {
      background-color: white; /* Light background */
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      height: calc(100vh - 126px); /* Adjust for header and footer height */
      z-index: 1000;
    }
    #mainSection, #mainArticle{
      width: 100%;
      height: 100%;
    }
    #monitor {
      width: 100%;
      height: 100%;
      position: relative;
      overflow: hidden;
      background: transparent;
    }
    #floor {
      width: 300%;
      height: 300%;
      position: absolute;
      background-image: url('./source/main-woodfloorbyfirefly.png');
      background-repeat: repeat;
      background-size: 50%;
      top: 0;
      left: 0;
    }
    #duck {
      width: 100px;
      height: 100px;
      background-image: url('./source/main-duck-lstand.png');
      background-size: contain;
      background-position: center;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1;
    }  
    @keyframes move-left {
      25% { background-image: url(./source/main-duck-lwalkframe1.png); }
      50% { background-image: url(./source/main-duck-lstand.png); }
      75% { background-image: url(./source/main-duck-lwalkframe2.png); }
      100% { background-image: url(./source/main-duck-lstand.png); }
    }
    
    @keyframes move-right {
      25% { background-image: url(./source/main-duck-rwalkframe1.png); }
      50% { background-image: url(./source/main-duck-rstand.png); }
      75% { background-image: url(./source/main-duck-rwalkframe2.png); }
      100% { background-image: url(./source/main-duck-rstand.png); }
    }
    
    .moving-left {
      animation: move-left 0.7s forwards infinite;
    }
    
    .moving-right {
      animation: move-right 0.7s forwards infinite;
    }
    
  </style>
</head>
<body>
  <!-- header -->
  <header class="navbar navbar-expand-lg navbar-dark bg-success">
    <nav class="container">
      <a class="navbar-brand" href="#">지금 뭐먹지?</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link active" href="#">breakfast</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">lunch</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">dinner</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#"><i class="fa-solid fa-moon"></i> night snack</a>
          </li>
         </ul>
      </div>
    </nav>
  </header>

  <!-- main -->
  <main class="container mt-5 pt-5" id="mainContainer">
    <section class="row" id="mainSection">
      <article class="col-12" id="mainArticle">
        <div id="monitor">
          <div id="floor"></div>
          <div id="duck"></div>
        </div>
      </article>
    </section>
  </main>

  <!-- footer -->
  <footer class="bg-success text-white mt-5 py-3">
    <div class="container text-center">
      <p class="mb-0">&copy; 과제에 GPT씨와 FireFly 씨가 매우많은 도움을 주셨으니 어쩌고 No rights reserved.</p>
    </div>
  </footer>
</body>
<script defer src="./js/js_main_menus.js"></script>
<script defer src="./js/js_main.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', (event) => {
    const floor = document.getElementById('floor');
    const duck = document.getElementById('duck');
    let lastKey = 'ArrowLeft'; // 초기 방향 설정

    // Set initial position to the center of the floor
    let topPosition = -(floor.offsetHeight / 2) + window.innerHeight / 2;
    let leftPosition = -(floor.offsetWidth / 2) + window.innerWidth / 2;

    floor.style.top = topPosition + 'px';
    floor.style.left = leftPosition + 'px';

    const step = 10; // Move step in pixels
    const keys = {};
    let animationFrameId;

    document.addEventListener('keydown', (e) => {
        keys[e.key] = true;
        lastKey = e.key; // 마지막으로 눌린 키 업데이트
        animateDuck(e.key);
        if (!animationFrameId) {
            animationFrameId = requestAnimationFrame(moveFloor);
        }
    });

    document.addEventListener('keyup', (e) => {
        keys[e.key] = false;
        stopDuckAnimation();
        if (!Object.values(keys).includes(true)) {
            cancelAnimationFrame(animationFrameId);
            animationFrameId = null;
        }
    });

    function moveFloor() {
        if (keys['ArrowUp'] || keys['w']) {
            topPosition = Math.min(0, topPosition + step);
        }
        if (keys['ArrowDown'] || keys['s']) {
            topPosition = Math.max(window.innerHeight - floor.offsetHeight, topPosition - step);
        }
        if (keys['ArrowLeft'] || keys['a']) {
            leftPosition = Math.min(0, leftPosition + step);
        }
        if (keys['ArrowRight'] || keys['d']) {
            leftPosition = Math.max(window.innerWidth - floor.offsetWidth, leftPosition - step);
        }

        // Diagonal movements
        if ((keys['ArrowUp'] || keys['w']) && (keys['ArrowLeft'] || keys['a'])) {
            topPosition = Math.min(0, topPosition + step / Math.sqrt(2));
            leftPosition = Math.min(0, leftPosition + step / Math.sqrt(2));
        }
        if ((keys['ArrowUp'] || keys['w']) && (keys['ArrowRight'] || keys['d'])) {
            topPosition = Math.min(0, topPosition + step / Math.sqrt(2));
            leftPosition = Math.max(window.innerWidth - floor.offsetWidth, leftPosition - step / Math.sqrt(2));
        }
        if ((keys['ArrowDown'] || keys['s']) && (keys['ArrowLeft'] || keys['a'])) {
            topPosition = Math.max(window.innerHeight - floor.offsetHeight, topPosition - step / Math.sqrt(2));
            leftPosition = Math.min(0, leftPosition + step / Math.sqrt(2));
        }
        if ((keys['ArrowDown'] || keys['s']) && (keys['ArrowRight'] || keys['d'])) {
            topPosition = Math.max(window.innerHeight - floor.offsetHeight, topPosition - step / Math.sqrt(2));
            leftPosition = Math.max(window.innerWidth - floor.offsetWidth, leftPosition - step / Math.sqrt(2));
        }

        floor.style.top = topPosition + 'px';
        floor.style.left = leftPosition + 'px';

        animationFrameId = requestAnimationFrame(moveFloor);
    }

    function animateDuck(key) {
        if (key === 'ArrowLeft' || key === 'a') {
            if (!duck.classList.contains('moving-left')) {
                duck.classList.remove('moving-right');
                duck.classList.add('moving-left');
                duck.style.backgroundImage = "url(./source/main-duck-lstand.png)";
            }
        }
        if (key === 'ArrowRight' || key === 'd') {
            if (!duck.classList.contains('moving-right')) {
                duck.classList.remove('moving-left');
                duck.classList.add('moving-right');
                duck.style.backgroundImage = "url(./source/main-duck-rstand.png)";
            }
        }
    }

    function stopDuckAnimation() {
        duck.classList.remove('moving-left');
        duck.classList.remove('moving-right');
    }
});

</script>
</html>
